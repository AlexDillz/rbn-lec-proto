<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–¢–µ—Å—Ç—ã</title>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../theme.js" defer></script>
  <style>
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center}
    .modal .card{max-width:420px;width:92%}
    .hidden{display:none}
    .q{margin:12px 0}
    .q h3{margin:0 0 8px;font-size:16px}
    .ok{padding:16px;border:1px solid var(--border);border-radius:12px;background:#eaffea;margin-top:12px}
  </style>
</head>
<body>
  <button id="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô Dark mode</button>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="regModal" class="modal">
    <article class="card">
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <p>–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ e-mail, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç.</p>
      <form id="regForm">
        <p><input required name="name" placeholder="–ò–º—è" style="width:100%;padding:8px"></p>
        <p><input required type="email" name="email" placeholder="E-mail" style="width:100%;padding:8px"></p>
        <button class="btn" type="submit">–ù–∞—á–∞—Ç—å</button>
      </form>
    </article>
  </div>

  <main class="card" style="margin-top:52px">
    <h1>–¢–µ—Å—Ç –ø–æ –ª–µ–∫—Ü–∏–∏</h1>
    <div id="quiz">
      <div class="q">
        <h3>1) –ö –∫–∞–∫–æ–º—É –ø–µ—Ä–∏–æ–¥—É –æ—Ç–Ω–æ—Å—è—Ç—Å—è –ø–µ—Ä–≤—ã–µ 1‚Äì3 –¥–Ω—è?</h3>
        <label><input type="radio" name="q1" value="a"> –û—Å–Ω–æ–≤–Ω–æ–π</label><br>
        <label><input type="radio" name="q1" value="b"> –ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–π</label><br>
        <label><input type="radio" name="q1" value="c"> –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π</label>
      </div>
      <div class="q">
        <h3>2) –ö—Ä–∞—Ç–∫–∏–π –¥–µ–≤–∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞:</h3>
        <label><input type="radio" name="q2" value="a"> –¢–µ–ø–ª–æ—Ç–∞! –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å!</label><br>
        <label><input type="radio" name="q2" value="b"> –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ! –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å! –ú–∞–∂–æ—Ä! –î—Ä—É–∂–±–∞!</label><br>
        <label><input type="radio" name="q2" value="c"> –£–¥–∏–≤–ª–µ–Ω–∏–µ! –¢–µ–º–ø! –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ!</label>
      </div>
      <div class="q">
        <h3>3) –ß—Ç–æ –¥–µ–ª–∞—Ç—å –∑–∞ 2‚Äì3 –¥–Ω—è –¥–æ –∫–æ–Ω—Ü–∞?</h3>
        <label><input type="radio" name="q3" value="a"> –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—é—Ä–ø—Ä–∏–∑—ã, –≥–æ—Ç–æ–≤–∏—Ç—å —Ç—ë–ø–ª–æ–µ —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏–µ</label><br>
        <label><input type="radio" name="q3" value="b"> –ù–∞–∑–Ω–∞—á–∞—Ç—å –æ—Ä–≥–∞–Ω–æ–≤ —Å–∞–º–æ—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label><br>
        <label><input type="radio" name="q3" value="c"> –ü—Ä–æ–≤–æ–¥–∏—Ç—å —Ä–∞–∑–≤–µ–¥–∫—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –¥–µ–ª</label>
      </div>
      <button id="submitBtn" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <div id="done" class="ok hidden">–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ! –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.</div>
    </div>
    <p style="margin-top:12px"><a class="btn" href="../index.html">‚Üê –ù–∞–∑–∞–¥</a></p>
  </main>

  <script>
    // === –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Å–µ–±—è ===
    const SCRIPT_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwLtmTSWFt10EFVejSxnYW649HqMflOY-NOO-qaR0pu5hQ0aoVDMLcSqcUlAaeZ8Gwl/exec';
    const TEST_ID = 'logic-shift-dev';

    let user = null;

    document.getElementById('regForm').addEventListener('submit', e=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      user = { name: fd.get('name'), email: fd.get('email') };
      document.getElementById('regModal').classList.add('hidden');
    });

    document.getElementById('submitBtn').addEventListener('click', async ()=>{
      if(!user){ alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å.'); return; }
      const answers = {
        q1: document.querySelector('input[name="q1"]:checked')?.value || null,
        q2: document.querySelector('input[name="q2"]:checked')?.value || null,
        q3: document.querySelector('input[name="q3"]:checked')?.value || null,
      };
      const correct = { q1:'c', q2:'b', q3:'a' };
      const score = Object.keys(correct).reduce((s,k)=> s + (answers[k]===correct[k] ? 1 : 0), 0);

      try{
        const payload = { ...user, testId: TEST_ID, score, answers };
        const r = await fetch(SCRIPT_ENDPOINT, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(payload)
        });
        await r.json();
        document.getElementById('done').classList.remove('hidden');
        // –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏: –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏/–ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–±–æ—Ä
      }catch(err){
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
        console.error(err);
      }
    });
  </script>
</body>
</html>
